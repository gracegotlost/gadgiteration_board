This is new version of code based on Joe, Jos, and Nicole.